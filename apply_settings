# Set time zone
echo Setting time zone and language
ln -sf /usr/share/zoneinfo/Asia/Seoul /etc/localtime
sed -i '/^#\(ko_KR.UTF-8 UTF-8\|en_US.UTF-8 UTF-8\) /s/^#//g' /etc/locale.gen
echo LANG=en_US.UTF-8 > /etc/locale.conf
locale-gen

echo "${username}-pc" >> /etc/hostname
echo "127.0.0.1 localhost\n::1 localhost\n127.0.1.1 ${username}-pc.org" >> /etc/hosts

groupadd sudo
useradd ${username} -g users -G storage,wheel,power,sudo -m -s /bin/bash
echo ${username}:${userpw} | chpasswd
echo "root:${userpw}" | chpasswd

echo "chowning /hdd..."
rm -rf /home/${username}/Downloads /home/${username}/Documents /home/${username}/Videos /home/${username}/Pictures /home/${username}/Music /home/${username}/Desktop
ln -s /hdd/Desktop /home/${username}/Desktop
ln -s /hdd/Pictures /home/${username}/Pictures
ln -s /hdd/Videos /home/${username}/Videos
ln -s /hdd/Downloads /home/${username}/Downloads
ln -s /hdd/Music /home/${username}/Music
ln -s /hdd/Documents /home/${username}/Documents
chown -R ${username}:users /hdd

# Install packages
echo Installing packages...
pacman -Syyu
yes | pacman -S git vim wget yajl base-devel linux

echo Changing sudo privileges
sed -i 's/^# %sudo ALL=(ALL) ALL/%sudo ALL=(ALL) ALL/' /etc/sudoers

echo "echo Installing pamac-AUR for GUI package managing
cd /tmp
git clone https://aur.archlinux.org/package-query.git
cd package-query/
makepkg -si && cd /tmp/
git clone https://aur.archlinux.org/yaourt.git
cd yaourt/
makepkg -si
yaourt -S pamac-aur
cd ~" > /hdd/Desktop/install_aur
chmod +x /hdd/Desktop/install_aur

yes | pacman -S grub efibootmgr os-prober
mkdir /windows
mount /dev/sda4 /windows
os-prober
yes | pacman -S intel-ucode

mkdir /esp
mount ${partition_boot} /esp
grub-install --target=x86_64-efi --efi-directory=esp --bootloader-id=GRUB
grub-mkconfig -o /boot/grub/grub.cfg
umount /esp
rm -rf /esp
umount /windows
rm -rf /windows

echo "\n" | pacman -S xorg xorg-server gnome gnome-tweaks nvidia cuda
systemctl enable gdm.service
