# Set time zone
echo Setting time zone and language
ln -sf /usr/share/zoneinfo/Asia/Seoul /etc/localtime
sed -i '/^#\(ko_KR.UTF-8 UTF-8\|en_US.UTF-8 UTF-8\) /s/^#//g' /etc/locale.gen
echo LANG=en_US.UTF-8 > /etc/locale.conf
locale-gen

echo "${username}-pc" >> /etc/hostname
echo "127.0.0.1 localhost\n::1 localhost\n127.0.1.1 ${username}-pc.org" >> /etc/hosts

groupadd sudo
useradd ${username} -g users -G storage,wheel,power,sudo -m -s /bin/bash
echo ${username}:${userpw} | chpasswd
echo "root:${userpw}" | chpasswd

echo "chowning /hdd..."
rm -rf /home/${username}/Downloads /home/${username}/Documents /home/${username}/Videos /home/${username}/Pictures /home/${username}/Music
ln -s /hdd/Pictures /home/${username}/Pictures
ln -s /hdd/Videos /home/${username}/Videos
ln -s /hdd/Downloads /home/${username}/Downloads
ln -s /hdd/Music /home/${username}/Music
ln -s /hdd/Documents /home/${username}/Documents
chown -R ${username}:users /hdd

# Install packages
echo Installing packages...
pacman -Syyu
echo "\n" | pacman -S base-devel
yes | pacman -S wget yajl linux sudo

echo Changing sudo privileges
sed -i 's/^# %sudo ALL=(ALL) ALL/%sudo ALL=(ALL) ALL/' /etc/sudoers

yes | pacman -S grub efibootmgr os-prober intel-ucode
mkdir /windows
mount /dev/sda4 /windows
os-prober

mkdir /esp
mount ${partition_boot} /esp
grub-install --target=x86_64-efi --efi-directory=esp --bootloader-id=GRUB
grub-mkconfig -o /boot/grub/grub.cfg
umount /esp
rm -rf /esp
umount /windows
rm -rf /windows

echo "\n" | pacman -S xorg xorg-server gnome gnome-tweaks dhcpcd
systemctl enable gdm.service
systemctl enable systemd-networkd.service
systemctl enable dhcpcd.service
